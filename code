import matplotlib.pyplot as plt
import pandas as pd

# Original DataFrame
original_df = df.copy()

# Function to create pie chart
def create_pie_chart(data, column_name):
    counts = data[column_name].value_counts()
    plt.figure(figsize=(4, 4))
    plt.pie(counts, labels=counts.index, autopct='%1.1f%%', startangle=140)
    plt.title(f'Distribution of {column_name}')
    plt.show()

# Create pie charts for each categorical variable before grouping
create_pie_chart(df, 'reportableData.tradeParty2CountryOfOtherCpty')
create_pie_chart(df, 'reportableData.premiumCurrency')
create_pie_chart(df, 'reportableData.leg1NotionalCurrency')
create_pie_chart(df, 'reportableData.leg2NotionalCurrency')
create_pie_chart(df, 'reportableData.leg1ExchangeRateBasisCurrency')
create_pie_chart(df, 'reportableData.leg2ExchangeRateBasisCurrency')

threshold = len(df) * 0.10

countryCpty_counts = df['reportableData.tradeParty2CountryOfOtherCpty'].value_counts()
less_frequent_CountryCpty = countryCpty_counts[countryCpty_counts < threshold].index
def group_countryCpty(countryCpty):
    return countryCpty if countryCpty not in less_frequent_CountryCpty else 'Other'
df['reportableData.tradeParty2CountryOfOtherCpty'] = df['reportableData.tradeParty2CountryOfOtherCpty'].apply(group_countryCpty)

premium_currency_counts = df['reportableData.premiumCurrency'].value_counts()
less_frequent_premium = premium_currency_counts[premium_currency_counts < threshold].index
def group_currency_premium(currency):
    return currency if currency not in less_frequent_premium else 'Other'
df['reportableData.premiumCurrency'] = df['reportableData.premiumCurrency'].apply(group_currency_premium)

notional_currency_counts = df['reportableData.leg1NotionalCurrency'].value_counts()
less_frequent_notional = notional_currency_counts[notional_currency_counts < threshold].index
def group_currency_notional(currency):
    return currency if currency not in less_frequent_notional else 'Other'
df['reportableData.leg1NotionalCurrency'] = df['reportableData.leg1NotionalCurrency'].apply(group_currency_notional)

notional2_currency_counts = df['reportableData.leg2NotionalCurrency'].value_counts()
less_frequent_notional2 = notional2_currency_counts[notional2_currency_counts < threshold].index
def group_currency_notional2(currency):
    return currency if currency not in less_frequent_notional2 else 'Other'
df['reportableData.leg2NotionalCurrency'] = df['reportableData.leg2NotionalCurrency'].apply(group_currency_notional2)

leg1_currency_counts = df['reportableData.leg1ExchangeRateBasisCurrency'].value_counts()
less_frequent_leg1 = leg1_currency_counts[leg1_currency_counts < threshold].index
def group_currency_leg1(currency):
    return currency if currency not in less_frequent_leg1 else 'Other'
df['reportableData.leg1ExchangeRateBasisCurrency'] = df['reportableData.leg1ExchangeRateBasisCurrency'].apply(group_currency_leg1)

leg2_currency_counts = df['reportableData.leg2ExchangeRateBasisCurrency'].value_counts()
less_frequent_leg2 = leg2_currency_counts[leg2_currency_counts < threshold].index
def group_currency_leg2(currency):
    return currency if currency not in less_frequent_leg2 else 'Other'
df['reportableData.leg2ExchangeRateBasisCurrency'] = df['reportableData.leg2ExchangeRateBasisCurrency'].apply(group_currency_leg2)

# Create pie charts for each categorical variable after grouping
create_pie_chart(df, 'reportableData.tradeParty2CountryOfOtherCpty')
create_pie_chart(df, 'reportableData.premiumCurrency')
create_pie_chart(df, 'reportableData.leg1NotionalCurrency')
create_pie_chart(df, 'reportableData.leg2NotionalCurrency')
create_pie_chart(df, 'reportableData.leg1ExchangeRateBasisCurrency')
create_pie_chart(df, 'reportableData.leg2ExchangeRateBasisCurrency')
