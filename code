def call_api_with_bearer_token(access_token, sso_token, where_conditions, field_names):
    api_url = "http://datafabric-dev:40003/datafabric/Tntr/TNTR-trade-dev"

    headers = {
        'Authorization': f'Bearer {sso_token}',
        'Content-Type': 'application/json'
    }

    data = {
        'where': where_conditions,
        'accessToken': access_token
    }

    response = requests.get(api_url, params=data, headers=headers)

    try:
        response.raise_for_status()
        json_data = response.json()
       
        for record in json_data:
            flattened_data = flatten_json(json.loads(record["document"]["contents"]))
            all_records.extend([flattened_data])
        
       
    except requests.exceptions.HTTPError as e:
        print(f"HTTP error occurred: {e}")
    except json.decoder.JSONDecodeError as e:
        print(f"Error decoding JSON response: {e}")
    except Exception as e:
        print(f"An error occurred: {e}")
